// システム設定初期化
g1=640 g2=480	// 画面サイズ
GSg1,g2;		// 画面サイズ設定
//SM1;			// BGM0番を再生
GW33;			// 速度ウエイト

// 画像描画(c1:x軸, c2:y軸, c3:画像番号)
// IN: @ポインタにキャラ構造体の先頭を入れておくこと
#0{
    x=@ y=@(1   // 座標を取得
    G@(2,x,y;		// 描画
}

// x,yを画面の範囲内に収める
#1{
	a=@ a<0 a[@=0]
	a=@ a+24 a>g1 a[@=g1 @-24]
	@>1
	a=@ a<0 a[@=0]
	a=@ a+32 a>g2 a[@=g2 @-32]
}

// 選択された画像に縁取りをつける
#2{
	GA70; a=4 // a:枠縁のサイズ
	r=100 g=200 b=150 x=@ y=@(1 x1=@(3 y1=@(4
	x-a y-a x1=CCx1+(a*2)+1; y1=CCy1+(a*2)+1; GB; // a*2はスクエア。+1は微調整。
	GA100;
}

// プレイヤーとの距離測定
// IN: @ポインタに測定対象のキャラ先頭
// OUT: r 目標までの距離
#3{
	x1=c1 y1=c2 x2=@ y2=@(1
	a1=CCx1-x2; a2=CCy1-y2;
	a1*a1 a2*a2 r=CCa1+a2;
	r=C_Qr;
}

// 距離に応じて音色を鳴らす
// IN: a 距離
#4{
	i=10
	[
		// 距離の値が大きいので、5000区切りで距離を測定
		b=i b*100 b=CCb<a; b[SSi; Si; i=1;]
	i-1 i]
}

// C構造体 @:c1
// @(0:x座標, @(1:y座標, @(2:画像番号, @(3:画像縦サイズ, @(4:画像横サイズ
// Player
@:c1
@=10 @(1=10 @(2=1 @(3=85 @(4=118 #0;

// Target
@:c6
@=100 @(1=100 @(2=2 @(3=85 @(4=118  #0;

// Total Char
c=2;

z=1 [
    GC;

	// マウス左クリック
	a=KML; a[
		x2=KMX; y2=KMY;		// マウスカーソルの位置を取得
		// カードとの判定を行い、当たっていたら効果音を鳴らす
		@:c1				// 敵の開始位置
		n=c n[n-1			// 敵数でループ
			a=CHx2,y2,@,@(1,@(3,@(4;	// 当たり判定
			a[#2 S4; n=0]		// 効果音を鳴らしループ終了
			
			@>5				// 次の敵へ
		n]
	]



	// @を設定し、関数で全キャラを描画
	i=1 l=0 l+c [
		@:c(i #0
		i+5
	l-1 l]

	// マウスカーソルの座標を取得
	x=KMX; y=KMY; G110;

	// ソナー（スペース）
	k=KSp; k[SS4; @:c4; #3; a=r #4;]
	
	// 終了キー（Esc）判定
	k=KEs; k[z=0]
	
	// デバッグ用テキスト
	GT500,30,"r="; GT530,30,r;
	
    // 画面出力（FLIP）
    GF;
z]